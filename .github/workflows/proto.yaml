name: proto
on:
  push:
    branches:
    - master
    paths:
    - 'api/**'
  pull_request:
    branches:
    - master
    paths:
    - 'api/**'
jobs:
  test:
    strategy:
      matrix:
        platform: [ macos-11 ]
        go-version: [ 1.17.x ]
        python-version: [ 3.x ]
    runs-on: ${{ matrix.platform }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v3.1.0

    - name: Install Go
      uses: actions/setup-go@v2
      with:
        go-version: ${{ matrix.go-version }}

    - name: Install Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'

    - name: Install protoc
      run: brew install protobuf

    - name: Check if srcs generated by protoc is up-to-date
      run: |
        make -C api
        if [[ $(git diff --name-only) != "" ]]; then \
          echo "proto srcs are not updated."; \
          exit 1; \
        fi


